{% extends 'layout.html' %}

{% load tags %}

{% block title %}
    Rental
{% endblock %}

{% block content %}
    <ol class="breadcrumb">
        <li>
            <a href="{% url 'depot:index' %}">Depots</a>
        </li>
        <li>
            <a href="{% url 'depot:detail' rental.depot.id %}">{{ rental.depot.name }}</a>
        </li>
        {% if managed_by_user %}
            <li>
                <a href="{% url 'depot:rentals' rental.depot.id %}">Rentals</a>
            </li>
        {% endif %}
        <li class="active">
            <span>{{ rental.uuid }}<span>
        </li>
    </ol>

    <div class="page-header">
        <h1>
            Rental <small>by {{ rental.firstname }} {{ rental.lastname }}</small>
        </h1>
    </div>

    <div class="panel panel-{{ bootstrap_classes|key:rental.state }}">
        <div class="panel-heading">
            <h2 class="panel-title">
                Details
            </h2>
        </div>
        <div class="panel-body">
            <dl class="dl-horizontal">
                <dt>Status</dt>
                <dd>
                    <span class="label label-{{ bootstrap_classes|key:rental.state }}">
                        {% rental_state rental.state %}
                    </span>
                </dd>

                <dt>Name</dt>
                <dd>{{ rental.firstname }} {{ rental.lastname }}</dd>

                <dt>Email</dt>
                <dd>
                    <a href="mailto:{{ rental.email }}">{{ rental.email }}</a>
                </dd>

                {% if rental.user %}
                    <dt>User</dt>
                    <dd>{{ rental.user }}
                {% endif %}

                <dt>Purpose</dt>
                <dd>{{ rental.purpose }}</dd>

                <dt>Start date</dt>
                <dd>{{ rental.start_date }}</dd>

                <dt>Return date</dt>
                <dd>{{ rental.return_date }}</dd>
            </dl>
        </div>

        <table class="table">
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Returned</th>
                <th>Location</th>
            </tr>

            {% for item in rental.itemrental_set.all %}
                <tr class="rental-item">
                    <td>{{ forloop.counter }}</td>
                    <td class="rental-item-name">{{ item.item.name }}</td>
                    <td class="rental-item-quantity">{{ item.quantity }}</td>
                    <td class="rental-item-returned">{{ item.returned }}</td>
                    <td class="rental-item-location">{{ item.item.location }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>

    {% for state in states %}
        <button type="button" class="btn btn-{{ bootstrap_classes|key:state }}"
                data-toggle="modal" data-target="#feedback-{{ state }}-modal">
            {{ btn_texts|key:state }}
        </button>
    {% endfor %}

    {% for state in states %}
        {% include 'rental/modals/feedback-modal.html' %}
    {% endfor %}

{% endblock %}
