{% extends 'layout.html' %}

{% load layout %}

{% block title %}
    {{ depot.name }}
{% endblock %}

{% block content %}
    {% if error_message %}
        <div class="alert alert-danger" role="alert">
            <div><strong>Error:</strong></div>
            {% for error in error_message %}
                <div>{{ error }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <h1>
        {{ depot.name }} <small>by {{ depot.organization.name }}</small>

        {% if managed_by_user %}
            <a href="{% url 'admin:depot_depot_change' depot.id %}" class="btn btn-default">Manage</a>
        {% endif %}
    </h1>

    <div class="alert alert-info">
        This depot is managed by
        {% for manager in depot.managers %}
            {% if not forloop.first %}
                {% if forloop.last %}
                    and
                {% else %}
                    ,
                {% endif %}
            {% endif %}
            {{ manager }}
        {% endfor %}
    </div>

    <form method="post" action="{% url 'rental:create' %}">
        {% csrf_token %}

        <input type="hidden" name="depot_id" value="{{ depot.id }}">

        <table class="table">
            <tr>
                <th>Name</th>
                <th>Quantity</th>
                <th>Location</th>
                {% if user.is_authenticated %}
                    <th>Visibility</th>
                {% endif %}
                <th>Selected</th>
            </tr>

            {% for item in item_list %}
                <tr class="rental-item">
                    <td class="rental-item-name">{{ item.name }}</td>
                    <td class="rental-item-quantity">{{ item.quantity }}</td>
                    <td class="rental-item-location">{{ item.location }}</td>
                    {% if user.is_authenticated %}
                        <td>{% item_visibility item.visibility %}</td>
                    {% endif %}
                    <td class="rental-item-selected">
                        <input type="number" name="item-{{ item.id }}-quantity"
                               min="0" max="{{ item.quantity }}" value="0">
                    </td>
                </tr>
            {% endfor %}
        </table>

        {% include 'depot/checkout-modal.html' %}
    </form>
{% endblock %}
